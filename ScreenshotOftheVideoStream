 Перем Соединение;


Процедура ПолучитьИзображениеСКамеры(ФормаОбработки) Экспорт
	
	Если ПолучитьСоединениеСКамерой() Тогда
		Сообщить("Не установлено соединение с сервером");
		Возврат;
	КонецЕсли;

	//ТекущаяКамера = ФормаОбработки.ЭлементыФормы.СписокКамер.Значение;
	//
	//Если Не ЗначениеЗаполнено(ТекущаяКамера) Тогда
	//	Сообщить("Не выбрана камера");
	//	Возврат;
	//КонецЕсли;
	
	//Получение файла со списком камер.
	ИмяФайлаИзображение = КаталогВременныхФайлов() + "image.jpg";
	Соединение.Получить("/Streaming/channels/1/picture?snapShotImageType=JPEG", ИмяФайлаИзображение);
	
	//Если ФормаОбработки.ОткрытьВ1С = 1 Тогда
		
		ФормаИзображение = ПолучитьФорму("ФормаИзображения");
	
		ФормаИзображение.ВладелецФормы           = ФормаОбработки;
		ФормаИзображение.НачальноеЗначениеВыбора = ИмяФайлаИзображение;
	
		ФормаИзображение.Открыть();
		
	//Иначе
	//
	//	Попытка
	//		ЗапуститьПриложение(ИмяФайлаИзображение);
	//	Исключение
	//		Сообщить(ОписаниеОшибки(), СтатусСообщения.Важное);
	//	КонецПопытки;
	//
	//КонецЕсли;
	
КонецПроцедуры

Функция ПолучитьСоединениеСКамерой() Экспорт 
	
	Отказ = Ложь;
	
	Если Соединение = Неопределено Тогда
		
		Если ПустаяСтрока(АдресКамеры) Тогда
			Сообщить("Не указан адрес камеры!", СтатусСообщения.Важное);
			Отказ = Истина;
		КонецЕсли;
		
		Если Не Отказ Тогда
			
			Попытка	
				//ИнтернетПрокси = Неопределено;
				//
				//Если ПроксиИспользование Тогда
				//	
				//	ИнтернетПрокси = Новый ИнтернетПрокси;
				//	ИнтернетПрокси.Пользователь = ПроксиИмяПользователя;
				//	ИнтернетПрокси.Пароль		= ПроксиПароль;
				//	
				//	Если ПроксиПорт = 0 Тогда
				//		ИнтернетПрокси.Установить("HTTP", ПроксиСервер);
				//	Иначе
				//		ИнтернетПрокси.Установить("HTTP", ПроксиСервер, ПроксиПорт);
				//	КонецЕсли;
				//	
				//КонецЕсли;
				
				Соединение = Новый HTTPСоединение(АдресКамеры, 80, "admin", "9108765051", , Ложь);
				
			Исключение
				Сообщить(ОписаниеОшибки(), СтатусСообщения.Важное);
				Отказ = Истина;
			КонецПопытки;
			
		КонецЕсли;
		
	КонецЕсли;
	
	Возврат Отказ;
	
КонецФункции

