Процедура ПередЗаписью(Отказ, Замещение)
	Для Каждого Запись Из ЭтотОбъект Цикл
	Файл = ПолучитьФайлПоСсылке(Запись.СсылкаНаВеселуюКартинку);
	Запись.MD5ВеселойКартинки  = МД5(Запись.СсылкаНаВеселуюКартинку);
КонецЦикла;

	
	
КонецПроцедуры

Функция  МД5(Путь) 
	
	crypt = Новый COMОбъект("CAPICOM.HashedData");
	crypt.Algorithm = 3;    
	
	stream = Новый COMОбъект("ADODB.Stream");
	stream.Type = 1;
	stream.Open();
	stream.LoadFromFile(Путь);
	Пока НЕ stream.EOS Цикл
		crypt.Hash(stream.Read());
	КонецЦикла; 
	
	Возврат crypt.Value;
	
КонецФункции

Функция ПолучитьФайлПоСсылке(Путь)
	ИмяФайла = Путь;
	ВыбФайл = Новый Файл(ИмяФайла);
	Если ВыбФайл.Существует() Тогда
		Возврат ВыбФайл;
	Иначе
		Предупреждение("Файл не найден!");
		Возврат Ложь;
	КонецЕсли;	
КонецФункции
